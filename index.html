<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>3í•™ë…„6ë°˜ ëŸ¬ë‹ì±Œë¦°ì§€ </title>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    label, input, button, option { margin: 0.5rem 0; padding: 1rem; font-size: 1.5rem}
    canvas { margin-top: 2rem; }
  </style>
</head>
<body>
  <h1>100ì¼ 100km ë‹¬ë¦¬ê¸°ğŸƒâ€â™€â€â¡ (4/17 ~ 7/26) </h1>
  <label for="nameSelect">ì´ë¦„ ì„ íƒ:</label>
  <select id="nameSelect">
    <option value="í˜„ì„œ">í˜„ì„œ</option>
    <option value="ì„¤í¬">ì„¤í¬</option>
    <option value="ë¯¸ì •">ë¯¸ì •</option>
    <option value="ì±„ë¦¼">ì±„ë¦¼</option>
    <option value="ì„±ì€">ì„±ì€</option>
    <option value="í¬ì—°">í¬ì—°</option>
    <option value="ì˜ˆì„ ">ì˜ˆì„ </option>
  </select>
  <input id="scoreInput" placeholder="ê¸°ë¡ ì…ë ¥" type="number" step="any">
  <button onclick="addRecord()">ê¸°ë¡ ì¶”ê°€</button>

  <canvas id="myChart" width="400" height="300"></canvas>

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAOR6JDTeZu9pk3_bcvN6oaa6KE0uUOyQ0",
      authDomain: "run3-6.firebaseapp.com",
      projectId: "run3-6",
      storageBucket: "run3-6.firebasestorage.app",
      messagingSenderId: "1095413394899",
      appId: "1:1095413394899:web:560a45543a50ccb8b81326"
    };

  // Initialize Firebase
    const app = initializeApp(firebaseConfig);


    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const collection = db.collection("records");
    let chartInstance = null;

    window.addRecord = async function () {
      const name = document.getElementById("nameInput").value.trim();
      const score = parseFloat(document.getElementById("scoreInput").value);
      if (!name || isNaN(score)) return alert("ì´ë¦„ê³¼ ìˆ«ìë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš©");

      await collection.add({
        name,
        score,
        timestamp: new Date().toISOString()
      });
      alert("ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤");
      drawChart();
    }

    window.drawChart = async function () {
      const snapshot = await collection.get();
      const dataMap = {};

      snapshot.forEach(doc => {
        const { name, score } = doc.data();
        if (!dataMap[name]) dataMap[name] = 0;
        dataMap[name] += score;
      });

      const dataArray = Object.entries(dataMap).sort((a, b) => b[1] - a[1]);
      // const labels = dataArray.map(item => item[0]);
      const labels = dataArray.map((item, index) => {
        const emoji = index === 0 ? ' ğŸ¥‡' : index === 1 ? ' ğŸ¥ˆ' : index === 2 ? ' ğŸ¥‰' : '';
        return item[0] + emoji;
      });
      const values = dataArray.map(item => item[1]);

      const decoratedLabels = labels.map((label, i) => `${label}  ğŸƒâ€â™€ï¸â€â¡ï¸`);
      const ctx = document.getElementById("myChart").getContext("2d");
      if (chartInstance) {
        chartInstance.destroy();
      }
      chartInstance = new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "ëˆ„ì  ê¸°ë¡",
            data: values,
            backgroundColor: "rgba(54, 162, 235, 0.6)"
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          scales: {
            x: { beginAtZero: true }
          }
        }
      });
    }
    window.onload = drawChart;
  </script>
</body>
</html>
